# NAuth Authentication System - NPM Package Library

## Project Overview
Create a modern, reusable **React component library** distributed as an NPM package using React, TypeScript, Vite, and Tailwind CSS. **This is a standalone NPM package designed to be installed via `npm install` into any React application**. It integrates with the NAuth API (a .NET 8 authentication microservice) and provides ready-to-use components for registration, login, profile management, and password recovery.

### Package Architecture
- **Package Type**: React Component Library (NPM Package)
- **Package Name**: `@nauth/react-auth` or `nauth-react-components`
- **Distribution**: Published to NPM registry (public or private)
- **Installation**: `npm install @nauth/react-auth`
- **Usage**: Import components, hooks, and utilities into any React app
- **Standalone**: Includes dev environment with Storybook for testing
- **Theme Support**: Light and Dark theme with customizable styling
- **Tree-shakeable**: Import only what you need for optimal bundle size

## Technology Stack
- **Build Tool**: Vite 5+ (Library Mode)
- **Frontend Framework**: React 18+ with TypeScript
- **Styling**: Tailwind CSS (peer dependency) + CSS-in-JS for component isolation
- **State Management**: React Context API (exported)
- **HTTP Client**: Axios
- **Form Validation**: React Hook Form + Zod
- **Icons**: Lucide React
- **Device Fingerprinting**: @fingerprintjs/fingerprintjs
- **Theme**: next-themes for light/dark mode
- **Development**: Storybook 7+ for component documentation
- **Testing**: Vitest + React Testing Library

## Package Configuration

### Package Structure
```
@nauth/react-auth/
├── dist/                      # Built package (generated)
│   ├── index.js              # ESM bundle
│   ├── index.cjs             # CommonJS bundle  
│   ├── index.d.ts            # TypeScript declarations
│   └── style.css             # Compiled styles
├── src/
│   ├── components/           # Exportable React components
│   │   ├── LoginForm/
│   │   ├── RegisterForm/
│   │   ├── ProfileForm/
│   │   ├── PasswordForms/
│   │   ├── Navigation/
│   │   └── ui/              # shadcn/ui base components
│   ├── contexts/            # React Context providers
│   │   ├── AuthContext.tsx
│   │   └── ThemeContext.tsx
│   ├── hooks/               # Custom React hooks
│   │   ├── useAuth.ts
│   │   ├── useUser.ts
│   │   └── useProtectedRoute.ts
│   ├── services/            # API client services
│   │   ├── nauth-api.ts
│   │   └── client-factory.ts
│   ├── types/               # TypeScript definitions
│   │   └── index.ts
│   ├── utils/               # Utility functions
│   │   ├── validators.ts
│   │   └── formatters.ts
│   ├── styles/              # Global styles
│   │   └── index.css
│   └── index.ts             # Main entry point (exports)
├── .storybook/              # Storybook configuration
├── stories/                 # Component stories
├── __tests__/               # Test files
├── examples/                # Usage examples
├── package.json
├── vite.config.ts
├── tsconfig.json
├── tailwind.config.js
└── README.md
```

### Vite Configuration for Library Mode

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react-swc';
import path from 'path';
import { resolve } from 'path';
import dts from 'vite-plugin-dts';
import tailwindcss from 'tailwindcss';
import autoprefixer from 'autoprefixer';

export default defineConfig({
  plugins: [
    react(),
    dts({
      insertTypesEntry: true,
      include: ['src/**/*'],
      exclude: ['**/*.stories.tsx', '**/*.test.tsx', '**/*.spec.tsx'],
      rollupTypes: true,
    }),
  ],
  css: {
    postcss: {
      plugins: [tailwindcss, autoprefixer],
    },
  },
  build: {
    lib: {
      entry: resolve(__dirname, 'src/index.ts'),
      name: 'NAuthReact',
      formats: ['es', 'cjs'],
      fileName: (format) => `index.${format === 'es' ? 'js' : 'cjs'}`,
    },
    rollupOptions: {
      external: [
        'react',
        'react-dom',
        'react/jsx-runtime',
        'react-router-dom',
      ],
      output: {
        globals: {
          react: 'React',
          'react-dom': 'ReactDOM',
          'react-router-dom': 'ReactRouterDOM',
        },
        assetFileNames: (assetInfo) => {
          if (assetInfo.name === 'style.css') return 'style.css';
          return assetInfo.name;
        },
      },
    },
    sourcemap: true,
    emptyOutDir: true,
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
```

### Package.json Configuration

```json
{
  "name": "@nauth/react-auth",
  "version": "1.0.0",
  "description": "React authentication components for NAuth API integration",
  "author": "Your Name <your.email@example.com>",
  "license": "MIT",
  "type": "module",
  "main": "./dist/index.cjs",
  "module": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "import": {
        "types": "./dist/index.d.ts",
        "default": "./dist/index.js"
      },
      "require": {
        "types": "./dist/index.d.ts",
        "default": "./dist/index.cjs"
      }
    },
    "./styles": "./dist/style.css",
    "./package.json": "./package.json"
  },
  "files": [
    "dist",
    "README.md",
    "LICENSE"
  ],
  "sideEffects": [
    "*.css"
  ],
  "keywords": [
    "react",
    "authentication",
    "auth",
    "nauth",
    "login",
    "register",
    "components",
    "typescript",
    "tailwind"
  ],
  "repository": {
    "type": "git",
    "url": "https://github.com/your-org/nauth-react-auth"
  },
  "bugs": {
    "url": "https://github.com/your-org/nauth-react-auth/issues"
  },
  "homepage": "https://github.com/your-org/nauth-react-auth#readme",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "test": "vitest run",
    "test:watch": "vitest",
    "test:coverage": "vitest run --coverage",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build",
    "prepublishOnly": "npm run build",
    "type-check": "tsc --noEmit"
  },
  "peerDependencies": {
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "react-router-dom": "^6.30.0"
  },
  "dependencies": {
    "@fingerprintjs/fingerprintjs": "^4.6.2",
    "@hookform/resolvers": "^3.10.0",
    "@radix-ui/react-avatar": "^1.1.10",
    "@radix-ui/react-dialog": "^1.1.14",
    "@radix-ui/react-dropdown-menu": "^2.1.15",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-select": "^2.2.5",
    "@radix-ui/react-separator": "^1.1.7",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-tabs": "^1.1.12",
    "@radix-ui/react-toast": "^1.2.14",
    "axios": "^1.11.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^3.6.0",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "react-hook-form": "^7.61.1",
    "sonner": "^1.7.4",
    "tailwind-merge": "^2.6.0",
    "zod": "^3.25.76"
  },
  "devDependencies": {
    "@storybook/addon-essentials": "^7.6.17",
    "@storybook/addon-interactions": "^7.6.17",
    "@storybook/addon-links": "^7.6.17",
    "@storybook/blocks": "^7.6.17",
    "@storybook/react": "^7.6.17",
    "@storybook/react-vite": "^7.6.17",
    "@testing-library/jest-dom": "^6.1.5",
    "@testing-library/react": "^14.1.2",
    "@testing-library/user-event": "^14.5.1",
    "@types/react": "^18.3.23",
    "@types/react-dom": "^18.3.7",
    "@vitejs/plugin-react-swc": "^3.11.0",
    "@vitest/coverage-v8": "^1.2.2",
    "autoprefixer": "^10.4.21",
    "eslint": "^9.32.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-storybook": "^0.6.15",
    "jsdom": "^23.2.0",
    "postcss": "^8.5.6",
    "storybook": "^7.6.17",
    "tailwindcss": "^3.4.17",
    "typescript": "^5.8.3",
    "vite": "^5.4.19",
    "vite-plugin-dts": "^3.7.3",
    "vitest": "^1.2.2"
  }
}
```

### Main Entry Point

```typescript
// src/index.ts - Package exports

// Authentication Components
export { LoginForm } from './components/LoginForm';
export { RegisterForm } from './components/RegisterForm';
export { ForgotPasswordForm } from './components/ForgotPasswordForm';
export { ResetPasswordForm } from './components/ResetPasswordForm';

// Profile & User Management Components
export { ProfileForm } from './components/ProfileForm';
export { ChangePasswordForm } from './components/ChangePasswordForm';
export { UserDashboard } from './components/UserDashboard';
export { UserAvatar } from './components/UserAvatar';

// Admin Components
export { UserTable } from './components/UserTable';
export { UserDetailsCard } from './components/UserDetailsCard';
export { RoleManager } from './components/RoleManager';

// Navigation Components
export { AuthNavigation } from './components/Navigation';

// Context Providers & Hooks
export { NAuthProvider, useNAuth } from './contexts/NAuthContext';
export type { NAuthConfig, NAuthContextValue } from './contexts/NAuthContext';

export { ThemeProvider, useTheme } from './contexts/ThemeContext';
export type { Theme } from './contexts/ThemeContext';

// Custom Hooks
export { useAuth } from './hooks/useAuth';
export { useUser } from './hooks/useUser';
export { useProtectedRoute } from './hooks/useProtectedRoute';

// API Client
export { NAuthAPI } from './services/nauth-api';
export { createNAuthClient } from './services/client-factory';

// TypeScript Types
export type {
  UserInfo,
  AuthSession,
  UserAddress,
  UserPhone,
  UserRole,
  LoginCredentials,
  RegisterData,
  ChangePasswordData,
  ApiResponse,
  ApiError,
} from './types';

// Utility Functions
export {
  validateCPF,
  validateCNPJ,
  validateEmail,
  validatePhone,
  formatPhone,
  formatDocument,
} from './utils/validators';

export { cn } from './utils/cn';

// Constants
export { API_ENDPOINTS } from './constants/endpoints';

// Package Version
export const VERSION = '1.0.0';
```

### Development Commands

```bash
# Install dependencies
npm install

# Start development server with example app
npm run dev

# Run Storybook for component development
npm run storybook

# Build the library
npm run build

# Run tests
npm test

# Run tests in watch mode
npm run test:watch

# Generate test coverage
npm run test:coverage

# Lint code
npm run lint

# Type check
npm run type-check

# Publish to NPM (after building)
npm publish --access public
```

## API Base URL
```
https://your-api-domain.com
```

## Complete API Documentation

### 1. User Controller (`/User`)

#### 1.1 Login with Email
**Endpoint**: `POST /User/loginWithEmail`
**Description**: Authenticate user with email and password
**Request Body**:
```json
{
  "email": "string",
  "password": "string"
}
```
**Response** (200 OK):
```json
{
  "token": "string (JWT token)",
  "user": {
    "userId": 1,
    "slug": "string",
    "imageUrl": "string (URL)",
    "name": "string",
    "email": "string",
    "hash": "string",
    "isAdmin": false,
    "birthDate": "2024-01-01T00:00:00Z",
    "idDocument": "string",
    "pixKey": "string",
    "password": null,
    "roles": [
      {
        "roleId": 1,
        "slug": "string",
        "name": "string"
      }
    ],
    "phones": [
      {
        "phone": "string"
      }
    ],
    "addresses": [
      {
        "zipCode": "string",
        "address": "string",
        "complement": "string",
        "neighborhood": "string",
        "city": "string",
        "state": "string"
      }
    ],
    "createAt": "2024-01-01T00:00:00Z",
    "updateAt": "2024-01-01T00:00:00Z"
  }
}
```
**Headers Required**:
- `X-Device-Fingerprint`: Device unique identifier
- `User-Agent`: Browser user agent

#### 1.2 Get Current User (Me)
**Endpoint**: `GET /User/getMe`
**Description**: Get authenticated user information
**Authentication**: Required (Bearer token)
**Response** (200 OK): Same as UserInfo object above

#### 1.3 Get User by ID
**Endpoint**: `GET /User/getById/{userId}`
**Description**: Get user information by user ID
**Response** (200 OK): UserInfo object

#### 1.4 Get User by Email
**Endpoint**: `GET /User/getByEmail/{email}`
**Description**: Get user information by email address
**Response** (200 OK): UserInfo object

#### 1.5 Get User by Slug
**Endpoint**: `GET /User/getBySlug/{slug}`
**Description**: Get user information by slug (URL-friendly identifier)
**Response** (200 OK): UserInfo object

#### 1.6 Insert New User (Registration)
**Endpoint**: `POST /User/insert`
**Description**: Register a new user account
**Request Body**:
```json
{
  "name": "string (required)",
  "email": "string (required, valid email)",
  "password": "string (required, min 8 chars)",
  "birthDate": "2024-01-01T00:00:00Z",
  "idDocument": "string (CPF or CNPJ)",
  "pixKey": "string",
  "phones": [
    {
      "phone": "string (numbers only)"
    }
  ],
  "addresses": [
    {
      "zipCode": "string",
      "address": "string",
      "complement": "string",
      "neighborhood": "string",
      "city": "string",
      "state": "string"
    }
  ],
  "roles": [
    {
      "roleId": 1
    }
  ]
}
```
**Response** (200 OK): UserInfo object

#### 1.7 Update User
**Endpoint**: `POST /User/update`
**Description**: Update authenticated user's information
**Authentication**: Required (Bearer token)
**Request Body**: Same as Insert User (without password)
**Response** (200 OK): UserInfo object

#### 1.8 Upload User Image
**Endpoint**: `POST /User/uploadImageUser`
**Description**: Upload user profile image
**Authentication**: Required (Bearer token)
**Content-Type**: multipart/form-data
**Request**: Form data with file field named "file"
**Response** (200 OK): String (image URL)

#### 1.9 Has Password
**Endpoint**: `GET /User/hasPassword`
**Description**: Check if user has a password set
**Authentication**: Required (Bearer token)
**Response** (200 OK): boolean

#### 1.10 Change Password
**Endpoint**: `POST /User/changePassword`
**Description**: Change user's password
**Authentication**: Required (Bearer token)
**Request Body**:
```json
{
  "oldPassword": "string (required if user has password)",
  "newPassword": "string (required, min 8 chars)"
}
```
**Response** (200 OK): "Password changed successfully"

#### 1.11 Send Recovery Email
**Endpoint**: `GET /User/sendRecoveryMail/{email}`
**Description**: Send password recovery email
**Response** (200 OK): "Recovery email sent successfully"

#### 1.12 Change Password Using Hash
**Endpoint**: `POST /User/changePasswordUsingHash`
**Description**: Reset password using recovery hash
**Request Body**:
```json
{
  "recoveryHash": "string (from email link)",
  "newPassword": "string (required, min 8 chars)"
}
```
**Response** (200 OK): "Password changed successfully"

#### 1.13 List Users
**Endpoint**: `GET /User/list/{take}`
**Description**: List users (pagination)
**Parameters**: 
- `take`: number of users to return
**Response** (200 OK): Array of UserInfo objects

### 2. Role Controller (`/Role`)

#### 2.1 List Roles
**Endpoint**: `GET /Role/list/{take}`
**Description**: List all roles
**Parameters**: 
- `take`: number of roles to return
**Response** (200 OK):
```json
[
  {
    "roleId": 1,
    "slug": "administrator",
    "name": "Administrator"
  }
]
```

#### 2.2 Get Role by ID
**Endpoint**: `GET /Role/getById/{roleId}`
**Description**: Get role information by ID
**Response** (200 OK): RoleInfo object

#### 2.3 Get Role by Slug
**Endpoint**: `GET /Role/getBySlug/{slug}`
**Description**: Get role information by slug
**Response** (200 OK): RoleInfo object

## Required Pages

### 1. Landing Page (`/`)
- Hero section with NAuth branding
- Features showcase
- Call-to-action buttons (Login, Register)
- Modern gradient design with animations
- **Theme Toggle**: Button to switch between light and dark theme
- Simple navigation menu

### 2. Login Page (`/login`)
- Email and password input fields
- "Remember me" checkbox
- Login button
- "Forgot password?" link
- "Create account" link
- Social login options (optional)
- Error handling and validation
- **Theme Support**: Styled for both light and dark modes

### 3. Registration Page (`/register`)
- Multi-step form:
  - Step 1: Basic info (name, email, password, confirm password)
  - Step 2: Personal info (birth date, ID document, phone)
  - Step 3: Address (optional)
- Form validation with real-time feedback
- Terms and conditions checkbox
- Submit button
- "Already have an account?" link
- **Theme Support**: Styled for both light and dark modes

### 4. Forgot Password Page (`/forgot-password`)
- Email input field
- Submit button
- Success message after submission
- "Back to login" link
- **Theme Support**: Styled for both light and dark modes

### 5. Reset Password Page (`/reset-password/:hash`)
- New password input
- Confirm password input
- Submit button
- Password strength indicator
- Success/error messages
- **Theme Support**: Styled for both light and dark modes

### 6. Dashboard/Home (Authenticated) (`/dashboard`)
- Welcome message with user name
- User statistics cards
- Quick actions
- Recent activity
- **Theme Toggle**: Visible in menu/header
- **Theme Support**: All components styled for both themes

### 7. Profile Page (`/profile`)
- View and edit user information
- Profile image upload with preview
- Tabbed interface:
  - Personal Info
  - Contact Info (phones)
  - Address Info
  - Security (change password)
- Save changes button
- Success/error notifications
- **Theme Support**: Styled for both light and dark modes

### 8. Change Password (Authenticated) (`/change-password`)
- Current password input
- New password input
- Confirm new password input
- Password strength indicator
- Submit button
- Success/error messages
- **Theme Support**: Styled for both light and dark modes

### 9. Users List (Admin only) (`/admin/users`)
- Searchable and filterable user list
- Pagination
- User cards/table with:
  - Profile image
  - Name
  - Email
  - Roles
  - Created date
- View user details action
- Edit user action (optional)
- **Theme Support**: Table/cards styled for both themes

### 10. User Details (Admin only) (`/admin/users/:id`)
- Complete user information display
- Roles management
- User activity log
- Edit button
- **Theme Support**: Styled for both light and dark modes

### 11. Roles Management (Admin only) (`/admin/roles`)
- List of all roles
- Role details (name, slug, permissions)
- Create/Edit role functionality (if API supports)
- **Theme Support**: Styled for both light and dark modes

## Navigation Menu Component

### Simple Navigation Menu
Create a clean, minimal navigation menu that:

1. **Public Routes (Not Authenticated)**:
   - Logo/Brand
   - Login
   - Register
   - Theme Toggle (Sun/Moon icon)

2. **Authenticated Routes (Regular User)**:
   - Logo/Brand
   - Dashboard
   - Profile
   - User Avatar with Dropdown:
     - My Profile
     - Change Password
     - Theme Toggle
     - Logout

3. **Authenticated Routes (Admin User)**:
   - Logo/Brand
   - Dashboard
   - Profile
   - Admin Dropdown:
     - Manage Users
     - Manage Roles
   - User Avatar with Dropdown:
     - My Profile
     - Change Password
     - Theme Toggle
     - Logout

### Navigation Implementation Example
```typescript
// src/components/Navigation.tsx
import { Link } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { Moon, Sun, User, LogOut, Shield } from 'lucide-react';
import { useTheme } from '@/hooks/use-theme';
import { useContext } from 'react';
import { UserContext } from '@/lib/nauth-core';

export function Navigation() {
  const { theme, setTheme } = useTheme();
  const userContext = useContext(UserContext);

  const toggleTheme = () => {
    setTheme(theme === 'light' ? 'dark' : 'light');
  };

  return (
    <nav className="border-b">
      <div className="container mx-auto px-4 py-3 flex items-center justify-between">
        <Link to="/" className="text-xl font-bold">
          NAuth
        </Link>
        
        <div className="flex items-center gap-4">
          {/* Public Menu */}
          {!userContext.sessionInfo?.token && (
            <>
              <Link to="/login">
                <Button variant="ghost">Login</Button>
              </Link>
              <Link to="/register">
                <Button>Register</Button>
              </Link>
            </>
          )}

          {/* Authenticated Menu */}
          {userContext.sessionInfo?.token && (
            <>
              <Link to="/dashboard">
                <Button variant="ghost">Dashboard</Button>
              </Link>
              <Link to="/profile">
                <Button variant="ghost">Profile</Button>
              </Link>
              
              {/* Admin Menu */}
              {userContext.user?.isAdmin && (
                <DropdownMenu>
                  <DropdownMenuTrigger asChild>
                    <Button variant="ghost">
                      <Shield className="h-4 w-4 mr-2" />
                      Admin
                    </Button>
                  </DropdownMenuTrigger>
                  <DropdownMenuContent>
                    <DropdownMenuItem asChild>
                      <Link to="/admin/users">Manage Users</Link>
                    </DropdownMenuItem>
                    <DropdownMenuItem asChild>
                      <Link to="/admin/roles">Manage Roles</Link>
                    </DropdownMenuItem>
                  </DropdownMenuContent>
                </DropdownMenu>
              )}

              {/* User Menu */}
              <DropdownMenu>
                <DropdownMenuTrigger asChild>
                  <Button variant="ghost" size="icon">
                    <User className="h-5 w-5" />
                  </Button>
                </DropdownMenuTrigger>
                <DropdownMenuContent align="end">
                  <DropdownMenuItem asChild>
                    <Link to="/profile">My Profile</Link>
                  </DropdownMenuItem>
                  <DropdownMenuItem asChild>
                    <Link to="/change-password">Change Password</Link>
                  </DropdownMenuItem>
                  <DropdownMenuSeparator />
                  <DropdownMenuItem onClick={userContext.logout}>
                    <LogOut className="h-4 w-4 mr-2" />
                    Logout
                  </DropdownMenuItem>
                </DropdownMenuContent>
              </DropdownMenu>
            </>
          )}

          {/* Theme Toggle */}
          <Button variant="ghost" size="icon" onClick={toggleTheme}>
            {theme === 'light' ? (
              <Moon className="h-5 w-5" />
            ) : (
              <Sun className="h-5 w-5" />
            )}
          </Button>
        </div>
      </div>
    </nav>
  );
}
```

## Theme Support (Light & Dark Mode)

### Theme Configuration
The application uses `next-themes` for theme management:

```typescript
// src/hooks/use-theme.tsx
import { createContext, useContext, useEffect, useState } from 'react';

type Theme = 'dark' | 'light' | 'system';

type ThemeProviderProps = {
  children: React.ReactNode;
  defaultTheme?: Theme;
  storageKey?: string;
};

type ThemeProviderState = {
  theme: Theme;
  setTheme: (theme: Theme) => void;
};

const ThemeProviderContext = createContext<ThemeProviderState | undefined>(undefined);

export function ThemeProvider({
  children,
  defaultTheme = 'system',
  storageKey = 'nauth-ui-theme',
  ...props
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(
    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
  );

  useEffect(() => {
    const root = window.document.documentElement;
    root.classList.remove('light', 'dark');

    if (theme === 'system') {
      const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light';
      root.classList.add(systemTheme);
      return;
    }

    root.classList.add(theme);
  }, [theme]);

  const value = {
    theme,
    setTheme: (theme: Theme) => {
      localStorage.setItem(storageKey, theme);
      setTheme(theme);
    },
  };

  return (
    <ThemeProviderContext.Provider {...props} value={value}>
      {children}
    </ThemeProviderContext.Provider>
  );
}

export const useTheme = () => {
  const context = useContext(ThemeProviderContext);
  if (context === undefined) throw new Error('useTheme must be used within a ThemeProvider');
  return context;
};
```

### Tailwind CSS Theme Configuration
```javascript
// tailwind.config.js
module.exports = {
  darkMode: ['class'],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        brand: {
          primary: '#7C3AED',
          secondary: '#DB2777',
          accent: '#06B6D4',
        },
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        secondary: {
          DEFAULT: 'hsl(var(--secondary))',
          foreground: 'hsl(var(--secondary-foreground))',
        },
        // ... other theme colors
      },
    },
  },
  plugins: [require('tailwindcss-animate')],
};
```

### CSS Variables for Themes
```css
/* src/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;
    /* ... other light theme variables */
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;
    /* ... other dark theme variables */
  }
}
```

### Theme-Aware Components
All shadcn/ui components automatically support both themes through CSS variables. Ensure all custom components use theme-aware colors:

```typescript
// Example: Theme-aware card component
<Card className="bg-card text-card-foreground">
  <CardHeader>
    <CardTitle className="text-foreground">User Profile</CardTitle>
  </CardHeader>
  <CardContent>
    <p className="text-muted-foreground">User information</p>
  </CardContent>
</Card>
```

## Micro-Frontend Integration Guidelines

### 1. Module Federation Architecture

#### Exposed Modules
The NAuth module exposes the following components and utilities:

```typescript
// src/types/exposed-modules.ts
export interface NAuthExposedModules {
  // Main application component
  App: React.ComponentType;
  
  // Navigation component
  Navigation: React.ComponentType;
  
  // Authentication context provider
  AuthProvider: React.ComponentType<{ children: React.ReactNode }>;
  
  // Page components
  Login: React.ComponentType;
  Register: React.ComponentType;
  Profile: React.ComponentType;
  Dashboard: React.ComponentType;
  
  // API service
  api: {
    login: (email: string, password: string) => Promise<AuthResult>;
    logout: () => void;
    getMe: () => Promise<UserInfo>;
    // ... other API methods
  };
  
  // TypeScript types
  types: {
    UserInfo: Type;
    AuthSession: Type;
    // ... other types
  };
}
```

#### Shared Dependencies
Configure shared dependencies to avoid duplication:

```typescript
// Shared dependencies configuration
const sharedDependencies = {
  'react': {
    singleton: true,
    requiredVersion: '^18.3.1',
    eager: false,
  },
  'react-dom': {
    singleton: true,
    requiredVersion: '^18.3.1',
    eager: false,
  },
  'react-router-dom': {
    singleton: true,
    requiredVersion: '^6.30.0',
    eager: false,
  },
  'axios': {
    singleton: true,
    requiredVersion: '^1.11.0',
  },
};
```

### 2. Module Isolation
- All routes are prefixed with `/nauth/`
- CSS is scoped using Tailwind's configuration
- No global state pollution
- Independent authentication state
- Module Federation ensures runtime isolation

### 3. Communication Interface

#### Cross-Module Communication
```typescript
// src/services/module-bridge.ts
export class NAuthModuleBridge {
  private static instance: NAuthModuleBridge;
  private eventBus: Map<string, Function[]> = new Map();

  static getInstance(): NAuthModuleBridge {
    if (!NAuthModuleBridge.instance) {
      NAuthModuleBridge.instance = new NAuthModuleBridge();
    }
    return NAuthModuleBridge.instance;
  }

  // Subscribe to authentication events
  onAuthChange(callback: (user: UserInfo | null) => void): () => void {
    const eventName = 'auth:change';
    if (!this.eventBus.has(eventName)) {
      this.eventBus.set(eventName, []);
    }
    this.eventBus.get(eventName)!.push(callback);

    // Return unsubscribe function
    return () => {
      const callbacks = this.eventBus.get(eventName) || [];
      const index = callbacks.indexOf(callback);
      if (index > -1) {
        callbacks.splice(index, 1);
      }
    };
  }

  // Emit authentication change event
  emitAuthChange(user: UserInfo | null): void {
    const callbacks = this.eventBus.get('auth:change') || [];
    callbacks.forEach(callback => callback(user));
  }

  // Public API for host applications
  getAPI() {
    return {
      isAuthenticated: () => !!localStorage.getItem('nauth_token'),
      getCurrentUser: () => JSON.parse(localStorage.getItem('nauth_user') || 'null'),
      getToken: () => localStorage.getItem('nauth_token'),
      logout: () => this.logout(),
      onAuthChange: (callback: (user: UserInfo | null) => void) => this.onAuthChange(callback),
    };
  }

  private logout(): void {
    localStorage.removeItem('nauth_token');
    localStorage.removeItem('nauth_user');
    this.emitAuthChange(null);
    window.location.href = '/nauth/login';
  }
}

// Export singleton instance
export const moduleBridge = NAuthModuleBridge.getInstance();

// Expose to window for host applications
if (typeof window !== 'undefined') {
  (window as any).NAuthModule = moduleBridge.getAPI();
}
```

#### Type-Safe Module API
```typescript
// src/types/module-api.ts
export interface NAuthModuleAPI {
  // Authentication status
  isAuthenticated: () => boolean;
  
  // Get current user
  getCurrentUser: () => UserInfo | null;
  
  // Get authentication token
  getToken: () => string | null;
  
  // Logout
  logout: () => void;
  
  // Subscribe to authentication changes
  onAuthChange: (callback: (user: UserInfo | null) => void) => () => void;
  
  // Navigate within module
  navigate: (path: string) => void;
}

// Global type declaration
declare global {
  interface Window {
    NAuthModule: NAuthModuleAPI;
  }
}
```

### 4. Standalone Mode
The application can run independently for development:

```typescript
// src/App.tsx
import { useEffect } from 'react';

const isStandalone = !window.parent || window.parent === window;

function App() {
  useEffect(() => {
    if (isStandalone) {
      console.log('Running in standalone mode');
      // Initialize standalone features
    } else {
      console.log('Running as federated module');
      // Initialize module federation features
    }
  }, []);

  // ...rest of app
}
```

### 5. Build Configuration for Module Federation

```typescript
// vite.config.ts - complete configuration
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import federation from "@originjs/vite-plugin-federation";

export default defineConfig(({ mode }) => ({
  base: '/nauth/',
  server: {
    host: "::",
    port: 8080,
    cors: true, // Enable CORS for module federation
  },
  plugins: [
    react(),
    mode === 'development' && componentTagger(),
    federation({
      name: 'nauth_module',
      filename: 'remoteEntry.js',
      exposes: {
        './App': './src/App.tsx',
        './Navigation': './src/components/Navigation.tsx',
        './AuthProvider': './src/contexts/AuthContext.tsx',
        './Login': './src/pages/Login.tsx',
        './Register': './src/pages/Register.tsx',
        './Profile': './src/pages/Profile.tsx',
        './Dashboard': './src/pages/Dashboard.tsx',
        './ChangePassword': './src/pages/ChangePassword.tsx',
        './ForgotPassword': './src/pages/ForgotPassword.tsx',
        './ResetPassword': './src/pages/ResetPassword.tsx',
        './AdminUsers': './src/pages/AdminUsers.tsx',
        './AdminRoles': './src/pages/AdminRoles.tsx',
        './api': './src/services/nauth-api.ts',
        './bridge': './src/services/module-bridge.ts',
        './types': './src/types/index.ts',
      },
      shared: {
        'react': { singleton: true, requiredVersion: '^18.3.1' },
        'react-dom': { singleton: true, requiredVersion: '^18.3.1' },
        'react-router-dom': { singleton: true, requiredVersion: '^6.30.0' },
        'axios': { singleton: true },
        'lucide-react': { singleton: true },
        'sonner': { singleton: true },
      }
    }),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  build: {
    modulePreload: false,
    target: 'esnext',
    minify: true,
    cssCodeSplit: false,
    rollupOptions: {
      output: {
        format: 'es',
        entryFileNames: 'assets/[name].[hash].js',
        chunkFileNames: 'assets/[name].[hash].js',
        assetFileNames: 'assets/[name].[hash].[ext]',
        minifyInternalExports: false,
      },
    },
  },
}));
```

### 6. Package.json Updates

```json
{
  "name": "nauth-module",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "preview": "vite preview",
    "lint": "eslint .",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "@fingerprintjs/fingerprintjs": "^4.6.2",
    "@hookform/resolvers": "^3.10.0",
    // ...existing dependencies
  },
  "devDependencies": {
    "@originjs/vite-plugin-federation": "^1.3.5",
    "@types/react": "^18.3.23",
    "@types/react-dom": "^18.3.7",
    "@vitejs/plugin-react-swc": "^3.11.0",
    "typescript": "^5.8.3",
    "vite": "^5.4.19"
  }
}
```

## Integration Examples

### Example 1: Full Module Integration

```typescript
// host-app/src/App.tsx
import { lazy, Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

const NAuthApp = lazy(() => import('nauth/App'));

function App() {
  return (
    <BrowserRouter>
      <div className="app">
        <header>My Application Header</header>
        <main>
          <Routes>
            <Route path="/" element={<HomePage />} />
            <Route path="/nauth/*" element={
              <Suspense fallback={<LoadingSpinner />}>
                <NAuthApp />
              </Suspense>
            } />
          </Routes>
        </main>
      </div>
    </BrowserRouter>
  );
}
```

### Example 2: Individual Component Integration

```typescript
// host-app/src/pages/LoginPage.tsx
import { lazy, Suspense } from 'react';

const NAuthLogin = lazy(() => import('nauth/Login'));

export function LoginPage() {
  return (
    <div className="custom-layout">
      <h1>Login to My App</h1>
      <Suspense fallback={<div>Loading login form...</div>}>
        <NAuthLogin />
      </Suspense>
    </div>
  );
}
```

### Example 3: Using Module API

```typescript
// host-app/src/components/ProtectedRoute.tsx
import { useEffect, useState } from 'react';
import { Navigate } from 'react-router-dom';

export function ProtectedRoute({ children }) {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // Wait for NAuth module to load
    const checkAuth = async () => {
      if (window.NAuthModule) {
        setIsAuthenticated(window.NAuthModule.isAuthenticated());
        setLoading(false);
      }
    };

    checkAuth();

    // Subscribe to auth changes
    const unsubscribe = window.NAuthModule?.onAuthChange((user) => {
      setIsAuthenticated(!!user);
    });

    return () => unsubscribe?.();
  }, []);

  if (loading) return <div>Loading...</div>;
  if (!isAuthenticated) return <Navigate to="/login" />;
  
  return children;
}
```

### Example 4: Shared State Between Host and Module

```typescript
// host-app/src/App.tsx
import { useEffect, useState } from 'react';
import type { UserInfo } from 'nauth/types';

function App() {
  const [currentUser, setCurrentUser] = useState<UserInfo | null>(null);

  useEffect(() => {
    // Get initial user
    if (window.NAuthModule) {
      setCurrentUser(window.NAuthModule.getCurrentUser());
    }

    // Listen for auth changes
    const unsubscribe = window.NAuthModule?.onAuthChange((user) => {
      setCurrentUser(user);
      console.log('User changed:', user);
    });

    return () => unsubscribe?.();
  }, []);

  return (
    <div>
      {currentUser ? (
        <p>Welcome, {currentUser.name}!</p>
      ) : (
        <p>Please log in</p>
      )}
    </div>
  );
}
```

## Component Props API

### LoginForm Props

```typescript
interface LoginFormProps {
  onSuccess?: (user: UserInfo) => void;
  onError?: (error: Error) => void;
  showRememberMe?: boolean;
  showForgotPassword?: boolean;
  showRegisterLink?: boolean;
  customSubmitText?: string;
  redirectAfterLogin?: string;
  className?: string;
  styles?: {
    container?: string;
    input?: string;
    button?: string;
  };
}
```

### RegisterForm Props

```typescript
interface RegisterFormProps {
  onSuccess?: (user: UserInfo) => void;
  onError?: (error: Error) => void;
  steps?: Array<'basic' | 'personal' | 'address'>;
  showProgressBar?: boolean;
  showTermsCheckbox?: boolean;
  termsUrl?: string;
  validateOnChange?: boolean;
  validateOnBlur?: boolean;
  redirectAfterRegister?: string;
  className?: string;
}
```

### ProfileForm Props

```typescript
interface ProfileFormProps {
  user?: UserInfo;
  onSuccess?: (user: UserInfo) => void;
  onError?: (error: Error) => void;
  showImageUpload?: boolean;
  enablePhoneEdit?: boolean;
  enableAddressEdit?: boolean;
  enableRoleEdit?: boolean;
  className?: string;
}
```

### UserTable Props

```typescript
interface UserTableProps {
  users?: UserInfo[];
  pageSize?: number;
  currentPage?: number;
  totalPages?: number;
  searchable?: boolean;
  filterable?: boolean;
  sortable?: boolean;
  columns?: Array<'name' | 'email' | 'roles' | 'phone' | 'createdAt' | 'actions'>;
  onUserClick?: (user: UserInfo) => void;
  onEdit?: (user: UserInfo) => void;
  onDelete?: (user: UserInfo) => void;
  onPageChange?: (page: number) => void;
  className?: string;
}
```

## NAuthProvider Configuration

```typescript
interface NAuthConfig {
  // Required: API Configuration
  apiUrl: string;
  
  // Optional: Request Configuration
  timeout?: number;
  headers?: Record<string, string>;
  
  // Optional: Storage Configuration
  storageKey?: string; // default: 'nauth_token'
  storageType?: 'localStorage' | 'sessionStorage'; // default: 'localStorage'
  
  // Optional: Behavior Configuration
  redirectOnUnauthorized?: string; // default: '/login'
  autoRefreshToken?: boolean; // default: false
  tokenRefreshInterval?: number; // in milliseconds
  
  // Optional: Security
  enableFingerprinting?: boolean; // default: true
  
  // Optional: Theme
  defaultTheme?: 'light' | 'dark' | 'system'; // default: 'system'
  themeStorageKey?: string; // default: 'nauth_theme'
  
  // Optional: Callbacks
  onAuthChange?: (user: UserInfo | null) => void;
  onLogin?: (user: UserInfo) => void;
  onLogout?: () => void;
  onError?: (error: Error) => void;
  
  // Optional: Validation
  passwordMinLength?: number; // default: 8
  requireSpecialChar?: boolean; // default: true
  requireNumber?: boolean; // default: true
}
```

## Styling and Customization

### Using Default Styles

```typescript
// Import default styles in your main file
import '@nauth/react-auth/styles';
```

### Custom Styling with Tailwind

```typescript
// Override with custom classes
<LoginForm
  className="my-custom-login"
  styles={{
    container: 'bg-white rounded-lg shadow-xl p-8',
    input: 'border-2 border-gray-300 focus:border-blue-500',
    button: 'bg-gradient-to-r from-purple-500 to-pink-500',
  }}
/>
```

### CSS Variables for Theming

```css
/* custom-theme.css */
:root {
  --nauth-primary: #7c3aed;
  --nauth-secondary: #db2777;
  --nauth-accent: #06b6d4;
  --nauth-radius: 0.5rem;
  --nauth-font-family: 'Inter', sans-serif;
}

.dark {
  --nauth-primary: #a78bfa;
  --nauth-secondary: #f472b6;
}
```

## Storybook Documentation

### Example Story

```typescript
// stories/LoginForm.stories.tsx
import type { Meta, StoryObj } from '@storybook/react';
import { LoginForm } from '../src/components/LoginForm';
import { NAuthProvider } from '../src/contexts/NAuthContext';

const meta: Meta<typeof LoginForm> = {
  title: 'Components/LoginForm',
  component: LoginForm,
  decorators: [
    (Story) => (
      <NAuthProvider config={{ apiUrl: 'http://localhost:8080' }}>
        <div className="max-w-md mx-auto p-8">
          <Story />
        </div>
      </NAuthProvider>
    ),
  ],
  tags: ['autodocs'],
};

export default meta;
type Story = StoryObj<typeof LoginForm>;

export const Default: Story = {};

export const WithRememberMe: Story = {
  args: {
    showRememberMe: true,
  },
};

export const WithAllOptions: Story = {
  args: {
    showRememberMe: true,
    showForgotPassword: true,
    showRegisterLink: true,
  },
};
```

## Testing

```typescript
// __tests__/LoginForm.test.tsx
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { LoginForm } from '../src/components/LoginForm';
import { NAuthProvider } from '../src/contexts/NAuthContext';

describe('LoginForm', () => {
  const wrapper = ({ children }: { children: React.ReactNode }) => (
    <NAuthProvider config={{ apiUrl: 'http://test.com' }}>
      {children}
    </NAuthProvider>
  );

  it('renders email and password inputs', () => {
    render(<LoginForm />, { wrapper });
    
    expect(screen.getByLabelText(/email/i)).toBeInTheDocument();
    expect(screen.getByLabelText(/password/i)).toBeInTheDocument();
  });

  it('calls onSuccess when login succeeds', async () => {
    const onSuccess = vi.fn();
    
    render(<LoginForm onSuccess={onSuccess} />, { wrapper });
    
    const emailInput = screen.getByLabelText(/email/i);
    const passwordInput = screen.getByLabelText(/password/i);
    const submitButton = screen.getByRole('button', { name: /sign in/i });

    fireEvent.change(emailInput, { target: { value: 'test@example.com' } });
    fireEvent.change(passwordInput, { target: { value: 'password123' } });
    fireEvent.click(submitButton);

    await waitFor(() => {
      expect(onSuccess).toHaveBeenCalled();
    });
  });
});
```

## Publishing to NPM

### Preparation Steps

1. **Create NPM Account**: https://www.npmjs.com/signup
2. **Login to NPM CLI**:
```bash
npm login
```

3. **Update package.json**:
   - Ensure correct version
   - Add description, keywords, author
   - Set repository URL
   - Add license

4. **Build the package**:
```bash
npm run build
```

5. **Test locally** before publishing:
```bash
# Pack the package
npm pack

# Install locally in a test project
cd ../test-project
npm install ../nauth-react-auth/nauth-react-auth-1.0.0.tgz
```

### Publishing

```bash
# Publish to public registry
npm publish --access public

# Or publish to private registry
npm publish
```

### Versioning

Follow [Semantic Versioning](https://semver.org/):

```bash
# Patch release (1.0.0 -> 1.0.1) - bug fixes
npm version patch
npm publish

# Minor release (1.0.0 -> 1.1.0) - new features
npm version minor
npm publish

# Major release (1.0.0 -> 2.0.0) - breaking changes
npm version major
npm publish
```

## CI/CD Pipeline

```yaml
# .github/workflows/publish.yml
name: Publish Package

on:
  release:
    types: [created]

jobs:
  publish:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          registry-url: 'https://registry.npmjs.org'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm test
      
      - name: Build package
        run: npm run build
      
      - name: Publish to NPM
        run: npm publish --access public
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
```

## Migration Guide

### From Direct API Integration

**Before:**
```typescript
// Your own API calls
const response = await fetch('/api/login', {
  method: 'POST',
  body: JSON.stringify({ email, password }),
});
```

**After:**
```typescript
import { NAuthProvider, LoginForm } from '@nauth/react-auth';

<NAuthProvider config={{ apiUrl: process.env.VITE_API_URL }}>
  <LoginForm onSuccess={(user) => console.log(user)} />
</NAuthProvider>
```

### From Other Auth Libraries

1. **Install the package**: `npm install @nauth/react-auth`
2. **Wrap app with NAuthProvider**
3. **Replace auth components** with NAuth components
4. **Update API calls** to use NAuth hooks
5. **Remove old auth dependencies**

## Additional Notes

- **Tree-shaking**: Import only what you need
- **TypeScript**: Full type safety included
- **SSR Compatible**: Works with Next.js, Remix, etc.
- **Bundle Size**: Core ~45KB gzipped (without peer deps)
- **Browser Support**: Modern browsers (ES2020+)
- **React Versions**: Compatible with React 18+
- **License**: MIT

## Deliverables

1. ✅ Complete NPM package with all components
2. ✅ Published to NPM registry
3. ✅ Full TypeScript support with .d.ts files
4. ✅ Storybook documentation
5. ✅ Unit tests with good coverage
6. ✅ ESM and CommonJS builds
7. ✅ Tree-shakeable exports
8. ✅ Peer dependencies properly configured
9. ✅ README with comprehensive examples
10. ✅ Migration guides
11. ✅ CI/CD pipeline
12. ✅ Versioning strategy
13. ✅ Theme support (light/dark)
14. ✅ Responsive components
15. ✅ Accessibility features

## Resources

- [Vite Library Mode](https://vitejs.dev/guide/build.html#library-mode)
- [NPM Publishing Guide](https://docs.npmjs.com/packages-and-modules/contributing-packages-to-the-registry)
- [React TypeScript Cheatsheet](https://react-typescript-cheatsheet.netlify.app/)
- [Storybook for React](https://storybook.js.org/docs/react/get-started/introduction)
- [Semantic Versioning](https://semver.org/)
- [Vitest Documentation](https://vitest.dev/)
- [React Testing Library](https://testing-library.com/react)